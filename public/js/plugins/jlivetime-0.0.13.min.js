"use strict";(function(e){var t=e.livetime=e.livetime||{};t.version="0.0.13",t.localTimeOffset=null;var n={datetimeSelector:"[datetime]",datetimeAttribute:"datetime",durationAttribute:"data-duration",dateLabelSelector:"[data-time-label]",triggerRefreshComplete:!0,serverTimeUrl:null,autostart:!1},r={_default:[[-28512e3,"yyyy MMMM d at H:mm"],[-2592e3,"in td_M months d_d days, MMMM d at H:mm"],[-604800,"in td_d days, MMMM d at H:mm"],[-172800,"next eeee, MMMM d at H:mm"],[-7200,"in td_h hours d_m minutes, at H:mm"],[-300,"in td_m minutes, at H:mm:ss"],[-60,"in td_m minutes d_s seconds, at H:mm:ss"],[0,"in td_s seconds, at H:mm:ss"],[60,"td_s seconds ago, at H:mm:ss"],[300,"td_m minutes d_s seconds ago, at H:mm:ss"],[7200,"td_m minutes ago, at H:mm:ss"],[172800,"td_h hours d_m minutes ago, at H:mm"],[604800,"last eeee, MMMM d at H:mm"],[2592e3,"MMMM d at H:mm"],["yyyy MMMM d at H:mm"]],seconds:[[0,"in td_hh:d_mm:d_ss"],["td_hh:d_mm:d_ss ago"]],milliseconds:[[0,"in td_hh:d_mm:d_ss.d_fff"],["td_hh:d_mm:d_ss.d_fff ago"]],humanized:[[-31104e3,"MMMM d, yyyy"],["daystart-604800","MMMM d at h:mm tt"],["daystart-86400","next eeee at h:mm tt"],["daystart","tomorrow at h:mm tt"],[-7200,"today at h:mm tt"],[-3600,"in about an hour"],[-120,"in td_m minutes"],[-60,"in about a minute"],[0,"in a few seconds"],[60,"a few seconds ago"],[120,"about a minute ago"],[3600,"td_m minutes ago"],[7200,"about an hour ago"],[18e3,"td_h hours ago"],["dayend","today at h:mm tt"],["dayend+86400","yesterday at h:mm tt"],["dayend+604800","last eeee at h:mm tt"],[31104e3,"MMMM d at h:mm tt"],["MMMM d, yyyy"]],fulldate:"eee MMM d yyyy at h:mm:ss tt",shortdate:"MMM d yyyy",_default_tooltip:"#fulldate",_in:[[0,"in"],[""]],remaining:[[0,"remaining"],[""]],ago:[[0,""],["ago"]],elapsed:[[0,""],["elapsed"]]},i=t.options=e.extend(!0,n,t.options);i.formats=e.extend(r,i.formats);var s=function(e,t){if(t<2)return e;var n=e+"";while(n.length<t)n="0"+n;return n},o={y:315576e5,M:2592e6,w:6048e5,d:864e5,e:864e5,h:36e5,m:6e4,s:1e3,f:1},u={M:"y",w:"M",d:"M",e:"w",h:"d",m:"h",s:"m",f:"s"},a={M:["January","February","March","April","May","June","July","August","September","October","November","December"],e:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},f=window.console&&typeof window.console.log=="function"?function(){console.log.call(console,arguments)}:function(){},l=/^(\d{4})\-(\d{2})\-(\d{2})(?:[ T](\d{2}):(\d{2}):(\d{2})(?:\.(\d+))?(.*))?$/,c=/^([+\-]?)(\d{2}):(\d{2})$/,h=[function(e){return new Date(e)},function(e){return new Date(e.slice(10,11)!==" "?e:e.slice(0,10)+"T"+e.slice(11))},function(e){var t=l.exec(e),n=0;if(t){for(var r=1;r<8;r++){var i=t[r];typeof i=="string"&&i.length>1&&i.slice(0,1)==="0"&&(t[r]=i.slice(0,-1).replace(/^0+/,"")+i.slice(-1))}if(typeof t[4]=="undefined"||t[4]===""||t[4]===null)return new Date(Date.UTC(parseInt(t[1]),parseInt(t[2])-1,parseInt(t[3])));if(t[8]&&t[8]!=="Z"&&t[8]!=="GMT"&&t[8]!=="UTC"){var s=c.exec(t[8]);if(!s)throw new Error("invalid datetime format");n=(s[0]==="-"?-1:1)*(parseInt(s[2])*60+parseInt(s[3]))*6e4}return new Date(Date.UTC(parseInt(t[1]),parseInt(t[2])-1,parseInt(t[3]),parseInt(t[4]),parseInt(t[5]),parseInt(t[6]),t[7]?parseInt(t[7]):0)+n)}throw new Error("invalid datetime format")}],p=h[h.length-1],d=function(){var e=!1,t=0,n={};n["2012-12-04 23:59:59.999Z"]=Date.UTC(2012,11,4,23,59,59,999),n["2012-01-31T00:54:02"]=Date.UTC(2012,0,31,0,54,2),n["2012-12-22T18:30:00-03:00"]=Date.UTC(2012,11,22,21,30,0),n["1987-02-28"]=Date.UTC(1987,1,28);while(!e&&t<h.length){try{e=!0;for(var r in n)if(n[r]!==h[t](r).getTime()){e=!1;break}e&&(p=h[t])}catch(i){e=!1}e||t++}};d(),t.parseDate=function(e){if(typeof str=="number"||/^[0-9]+$/.test(e))return new Date(parseInt(e,10));try{return p(e)}catch(t){throw new Error('error parsing datetime "'+e+'": '+t)}},t.now=function(){t.localTimeOffset===null&&t.getLocalTimeOffset();var e=t.localTimeOffset||0,n=new Date,r=n.getTime()-n.getTimezoneOffset()*60*1e3+e;return r},t.getLocalTimeOffset=function(){var n,r,s,o,u;if(!i.serverTimeUrl){t.localTimeOffset=0;return}if(!t.localTimeOffsetRequested&&(typeof t.localTimeOffset=="undefined"||t.localTimeOffset===null)){t.localTimeOffsetRequested=!0,t.localTimeOffset=0;var a=null;if(window.sessionStorage)a=window.sessionStorage.getItem("jlivetime-localtimeoffset");else try{a=/localtimeoffset=([0-9]+)[^0-9]?/i.exec(document.cookie)[1]}catch(l){a=null}typeof a!="undefined"&&a!==null?t.localTimeOffset=parseInt(a,10):e.ajax({url:i.serverTimeUrl,cache:!1,success:function(e,n,i){r=new Date,s=i.getResponseHeader("Date");var o=new Date(s);t.localTimeOffset=r.getTime()-o.getTime(),window.sessionStorage?window.sessionStorage.setItem("jlivetime-localtimeoffset",t.localTimeOffset):document.cookie="localtimeoffset="+t.localTimeOffset,t.localTimeOffset>1e4&&f("WARNING: local time offset is "+Math.round(t.localTimeOffset/1e3)+"s")}})}},t.millisecondsFromNow=function(e){var n=e;return e instanceof Date&&(n=e.getTime()+e.getTimezoneOffset()*60*1e3),t.now()-n},t.refresh=function(n){var r=(new Date).getTime(),s=e(n);s.addClass("jlivetime-active");var o=s.data("jlivetime-timeout");typeof o!="undefined"&&clearTimeout(o);var u=6e4,a=s.find(i.datetimeSelector);s.is(i.datetimeSelector)&&(a=a.add(s)),a.each(function(){var n=6e4,s=e(this),o=s.attr(i.datetimeAttribute);if(o){var a;try{if(o.indexOf("-")>0){var l=t.parseDate(o);a=l.getTime()-l.getTimezoneOffset()*6e4}else a=parseInt(o,10)}catch(c){f("error parsing timestamp: "+c),a=0}if(a>0){var h=t.millisecondsFromNow(a),p=0;try{var d=s.attr(i.durationAttribute);d&&(p=parseInt(d,10))}catch(c){f("error parsing duration: "+c),p=0}s.data("time-diff",h);var v=s.find(i.dateLabelSelector);s.is(i.dateLabelSelector)&&(v=v.add(s)),v.each(function(){var s=e(this),o=!1,u=!1,l;try{l=t.format(a,h,p,s.data("time-label")||"#_default")}catch(c){f("error updating time label: "+c),l={value:"-",nextRefreshMs:6e4}}l.value!==null&&typeof l.value!="undefined"&&s.html()!==l.value&&(s.html(l.value),o=!0),l.nextRefreshMs&&(n=Math.min(n,l.nextRefreshMs)),typeof s.data("time-tooltip")!="undefined"&&(l=t.format(a,h,p,s.data("time-tooltip")||"#_default_tooltip"),l.value!==null&&typeof l.value!="undefined"&&s.attr("title")!==l.value&&(s.attr("title",l.value),typeof s.attr("data-original-title")!="undefined"&&s.attr("data-original-title",l.value),u=!0),l.nextRefreshMs&&(n=Math.min(n,l.nextRefreshMs))),(o||u)&&i.triggerRefreshComplete&&s.trigger("refreshComplete",{nextRefreshMs:n,htmlChanged:o,tooltipChanged:u,refreshElapsedTime:(new Date).getTime()-r})}),h<0&&(n=Math.min(n,-h)),u=Math.min(u,n)}}s.data("jlivetime-nextrefresh",(new Date).getTime()+u)}),u=Math.max(u,65),s.data("jlivetime-timeout",setTimeout(function(){t.refresh(n)},u))},t.disable=function(t){var n=e(t),r=n.data("jlivetime-timeout");typeof r!="undefined"&&clearTimeout(r),n.removeClass("jlivetime-active")},t.formatPart=function(e,t,n){if(n==="[]")return{value:""};var r=/^(t?d_)?(([yMdewHhmsft])\3*)$/.exec(n);if(r)if(!r[1]){var i=new Date(e+(new Date(e)).getTimezoneOffset()*60*1e3);switch(r[3]){case"y":return{value:s(i.getFullYear(),r[2].length)};case"M":var f=r[2].length>2?a.M[i.getMonth()]:s(i.getMonth()+1,r[2].length);return r[2].length===3&&(f=f.slice(0,3)),{value:f};case"w":return{value:s(Math.floor(i.getDate()/7)+1,r[2].length)};case"d":return{value:s(i.getDate(),r[2].length)};case"e":var l=r[2].length>1?a.e[i.getDay()]:i.getDay()+1;return r[2].length>1&&r[2].length<=3&&(l=l.slice(0,r[2].length)),{value:l};case"h":return{value:s(i.getHours()>12?i.getHours()-12:i.getHours()===0?12:i.getHours(),r[2].length)};case"H":return{value:s(i.getHours(),r[2].length)};case"m":return{value:s(i.getMinutes(),r[2].length)};case"s":return{value:s(i.getSeconds(),r[2].length)};case"f":return{value:s(i.getMilliseconds(),r[2].length)};case"t":var c=i.getHours()>=12?"pm":"am";return{value:r[2].length>1?c:c.slice(0,1)}}}else{var h=o[r[3]];if(h){var p;p=Math.max(65,t>0?h-t%h:-t%h);if(r[1]=="td_")return{value:s(Math.floor(Math.abs(t/h)),r[2].length),nextRefreshMs:p};if(r[1]=="d_"){var d=o[u[r[3]]];return{value:s(Math.floor(Math.abs(d?t%d:t)/h),r[2].length),nextRefreshMs:p}}}}return{value:n}},t.getFormatExpression=function(e,n,r,s){var o=6e4,u=s;if(u===null||u==="null")u=null;else{if(typeof u=="string"&&u.slice(0,1)==="#"){u=i.formats[u.slice(1)];if(typeof u=="undefined")throw new Error("time format not found: "+s)}var a=e+(new Date).getTimezoneOffset()*60*1e3,l,c;if(u instanceof Array){var h=u.length;for(var p=0;p<h;p++){if(u[p].length===1){u=u[p][0];break}var d=u[p][0];if(typeof d=="string"){var v=/^([\w_]+)([+\-]\d+)?/i.exec(d);if(!v)return f("error parsing format range: "+d),{nextRefreshMs:1e3,format_expression:"-"};var m=v[1];if(m==="end")d=r;else if(m==="daystart")l||(l=(new Date(a)).setHours(0,0,0,0)-a),d=l;else{if(m!=="dayend")return f("error parsing format range, unknown keyword: "+m),{nextRefreshMs:1e3,format_expression:"-"};c||(c=(new Date(a)).setHours(23,59,59,999)-a),d=c}v[2]&&(d+=parseInt(v[2],10)*1e3)}else d*=1e3;if(d>=n){o=Math.min(o,d-n),u=u[p][1];break}}u instanceof Array&&(u="<unknown>")}if(typeof u=="string"&&u.slice(0,1)==="#")return t.getFormatExpression(e,n,r,u)}return{expression:u,nextRefreshMs:o}},t.format=function(e,n,r,i){var s=/\[?([a-z_]+)\]?/gim,o=[],u=0,a=t.getFormatExpression(e,n,r,i);if(a.expression===null)return a;var f=s.exec(a.expression);while(f){o.push(a.expression.slice(u,f.index));if(f[0].length!=f[1].length)o.push(f[1]);else{var l=f[0],c=0;l.slice(0,4)==="end_"&&(l=l.slice(4),c=r);var h=t.formatPart(e+c,n-c,l);o.push(h.value),h.nextRefreshMs&&(a.nextRefreshMs=Math.min(a.nextRefreshMs,h.nextRefreshMs))}u=f.index+f[0].length,f=s.exec(a.expression)}return o.push(a.expression.slice(u)),a.value=o.join(""),a},e.fn.livetime=function(n){this.each(function(){var r=e(this);if(!r.is(".jlivetime-active")){var i=e(this).parent(".jlivetime-active");i.length&&(r=i)}n===!1?t.disable(r.get(0)):t.refresh(r.get(0))})},e(function(){t.options.autostart&&e(t.options.autostart.selector||"body").livetime()})})(jQuery);